{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport type { NextRequest } from 'next/server';\r\n\r\n// Array of public routes that don't require authentication\r\nconst publicRoutes = ['/', '/login', '/signup', '/confirm-signup', '/auth/action'];\r\n\r\nexport async function middleware(request: NextRequest) {\r\n  const { pathname } = request.nextUrl;\r\n\r\n  // Allow public routes\r\n  if (publicRoutes.includes(pathname)) {\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // Check for session token\r\n  const session = request.cookies.get('session')?.value;\r\n\r\n  if (!session) {\r\n    return NextResponse.redirect(new URL('/login', request.url));\r\n  }\r\n\r\n  try {\r\n    // Verify token with Firebase Auth\r\n    const verifyEndpoint = `https://identitytoolkit.googleapis.com/v1/accounts:lookup?key=${process.env.NEXT_PUBLIC_FIREBASE_API_KEY}`;\r\n    const response = await fetch(verifyEndpoint, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({ idToken: session })\r\n    });\r\n\r\n    const data = await response.json();\r\n\r\n    // No user found or invalid token\r\n    if (!data.users?.[0]) {\r\n      throw new Error('Invalid session');\r\n    }\r\n\r\n    const user = data.users[0];\r\n\r\n    // Redirect unverified users to email verification page\r\n    if (!user.emailVerified && pathname !== '/confirm-signup') {\r\n      return NextResponse.redirect(new URL('/confirm-signup', request.url));\r\n    }\r\n\r\n    // Allow access to dashboard routes for verified users\r\n    if (user.emailVerified && pathname.startsWith('/dashboard')) {\r\n      const requestHeaders = new Headers(request.headers);\r\n      requestHeaders.set('user', JSON.stringify(user));\r\n      \r\n      return NextResponse.next({\r\n        headers: requestHeaders,\r\n      });\r\n    }\r\n\r\n    return NextResponse.next();\r\n  } catch (error) {\r\n    // Clear invalid session and redirect to login\r\n    const response = NextResponse.redirect(new URL('/login', request.url));\r\n    response.cookies.delete('session');\r\n    return response;\r\n  }\r\n}\r\n\r\nexport const config = {\r\n  matcher: [\r\n    /*\r\n     * Match all routes except:\r\n     * 1. /api (API routes)\r\n     * 2. /_next (Next.js internals)\r\n     * 3. /static (static files)\r\n     * 4. /*.* (files with extensions)\r\n     */\r\n    '/((?!api|_next|static|.*\\\\.[^/]*$).*)',\r\n  ],\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;;AAGA,2DAA2D;AAC3D,MAAM,eAAe;IAAC;IAAK;IAAU;IAAW;IAAmB;CAAe;AAE3E,eAAe,WAAW,OAAoB;IACnD,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,sBAAsB;IACtB,IAAI,aAAa,QAAQ,CAAC,WAAW;QACnC,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;IAC1B;IAEA,0BAA0B;IAC1B,MAAM,UAAU,QAAQ,OAAO,CAAC,GAAG,CAAC,YAAY;IAEhD,IAAI,CAAC,SAAS;QACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;IAC5D;IAEA,IAAI;QACF,kCAAkC;QAClC,MAAM,iBAAiB,CAAC,8DAA8D,+EAA4C;QAClI,MAAM,WAAW,MAAM,MAAM,gBAAgB;YAC3C,QAAQ;YACR,SAAS;gBACP,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;gBAAE,SAAS;YAAQ;QAC1C;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,iCAAiC;QACjC,IAAI,CAAC,KAAK,KAAK,EAAE,CAAC,EAAE,EAAE;YACpB,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,OAAO,KAAK,KAAK,CAAC,EAAE;QAE1B,uDAAuD;QACvD,IAAI,CAAC,KAAK,aAAa,IAAI,aAAa,mBAAmB;YACzD,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,mBAAmB,QAAQ,GAAG;QACrE;QAEA,sDAAsD;QACtD,IAAI,KAAK,aAAa,IAAI,SAAS,UAAU,CAAC,eAAe;YAC3D,MAAM,iBAAiB,IAAI,QAAQ,QAAQ,OAAO;YAClD,eAAe,GAAG,CAAC,QAAQ,KAAK,SAAS,CAAC;YAE1C,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;YACX;QACF;QAEA,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;IAC1B,EAAE,OAAO,OAAO;QACd,8CAA8C;QAC9C,MAAM,WAAW,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;QACpE,SAAS,OAAO,CAAC,MAAM,CAAC;QACxB,OAAO;IACT;AACF;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;KAMC,GACD;KACD;AACH"}}]
}