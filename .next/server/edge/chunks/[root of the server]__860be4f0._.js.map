{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\n\n// Array of public routes that don't require authentication\nconst publicRoutes = ['/', '/login', '/signup', '/confirm-signup', '/auth/action'];\n\nexport async function middleware(request: NextRequest) {\n  const { pathname } = request.nextUrl;\n\n  // Allow public routes\n  if (publicRoutes.includes(pathname)) {\n    return NextResponse.next();\n  }\n\n  // Check for session token\n  const session = request.cookies.get('session')?.value;\n\n  if (!session) {\n    return NextResponse.redirect(new URL('/login', request.url));\n  }\n\n  try {\n    // Verify token with Firebase Auth\n    const verifyEndpoint = `https://identitytoolkit.googleapis.com/v1/accounts:lookup?key=${process.env.NEXT_PUBLIC_FIREBASE_API_KEY}`;\n    const response = await fetch(verifyEndpoint, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({ idToken: session })\n    });\n\n    const data = await response.json();\n\n    // No user found or invalid token\n    if (!data.users?.[0]) {\n      throw new Error('Invalid session');\n    }\n\n    const user = data.users[0];\n\n    // Redirect unverified users to email verification page\n    if (!user.emailVerified && pathname !== '/confirm-signup') {\n      return NextResponse.redirect(new URL('/confirm-signup', request.url));\n    }\n\n    // Allow access to dashboard routes for verified users\n    if (user.emailVerified && pathname.startsWith('/dashboard')) {\n      const requestHeaders = new Headers(request.headers);\n      requestHeaders.set('user', JSON.stringify(user));\n      \n      return NextResponse.next({\n        headers: requestHeaders,\n      });\n    }\n\n    return NextResponse.next();\n  } catch (error) {\n    // Clear invalid session and redirect to login\n    const response = NextResponse.redirect(new URL('/login', request.url));\n    response.cookies.delete('session');\n    return response;\n  }\n}\n\nexport const config = {\n  matcher: [\n    /*\n     * Match all routes except:\n     * 1. /api (API routes)\n     * 2. /_next (Next.js internals)\n     * 3. /static (static files)\n     * 4. /*.* (files with extensions)\n     */\n    '/((?!api|_next|static|.*\\\\.[^/]*$).*)',\n  ],\n};\n"],"names":[],"mappings":";;;;AAAA;AAAA;;AAGA,2DAA2D;AAC3D,MAAM,eAAe;IAAC;IAAK;IAAU;IAAW;IAAmB;CAAe;AAE3E,eAAe,WAAW,OAAoB;IACnD,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,sBAAsB;IACtB,IAAI,aAAa,QAAQ,CAAC,WAAW;QACnC,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;IAC1B;IAEA,0BAA0B;IAC1B,MAAM,UAAU,QAAQ,OAAO,CAAC,GAAG,CAAC,YAAY;IAEhD,IAAI,CAAC,SAAS;QACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;IAC5D;IAEA,IAAI;QACF,kCAAkC;QAClC,MAAM,iBAAiB,CAAC,8DAA8D,+EAA4C;QAClI,MAAM,WAAW,MAAM,MAAM,gBAAgB;YAC3C,QAAQ;YACR,SAAS;gBACP,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;gBAAE,SAAS;YAAQ;QAC1C;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,iCAAiC;QACjC,IAAI,CAAC,KAAK,KAAK,EAAE,CAAC,EAAE,EAAE;YACpB,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,OAAO,KAAK,KAAK,CAAC,EAAE;QAE1B,uDAAuD;QACvD,IAAI,CAAC,KAAK,aAAa,IAAI,aAAa,mBAAmB;YACzD,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,mBAAmB,QAAQ,GAAG;QACrE;QAEA,sDAAsD;QACtD,IAAI,KAAK,aAAa,IAAI,SAAS,UAAU,CAAC,eAAe;YAC3D,MAAM,iBAAiB,IAAI,QAAQ,QAAQ,OAAO;YAClD,eAAe,GAAG,CAAC,QAAQ,KAAK,SAAS,CAAC;YAE1C,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;YACX;QACF;QAEA,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;IAC1B,EAAE,OAAO,OAAO;QACd,8CAA8C;QAC9C,MAAM,WAAW,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;QACpE,SAAS,OAAO,CAAC,MAAM,CAAC;QACxB,OAAO;IACT;AACF;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;KAMC,GACD;KACD;AACH"}}]
}