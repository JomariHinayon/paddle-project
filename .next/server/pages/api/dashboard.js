"use strict";(()=>{var e={};e.id=209,e.ids=[209],e.modules={8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return a}});var a=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},20105:(e,t,a)=>{a.r(t),a.d(t,{config:()=>p,default:()=>c,routeModule:()=>f});var n={};a.r(n),a.d(n,{default:()=>l});var r=a(33480),s=a(8667),i=a(86435),o=a(46675),u=a.n(o);u().apps.length||u().initializeApp({credential:u().credential.applicationDefault()});let d=u().firestore();async function l(e,t){if("GET"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let{userId:a}=e.query;if(!a)return t.status(400).json({message:"userId is required"});let n=d.collection("dashboard").doc(a);if(!(await n.get()).exists)return t.status(404).json({message:"Dashboard data not found"});let r=d.collection("users").doc(a),s=await r.get();if(!s.exists)return t.status(404).json({message:"User data not found"});let i=s.data(),o=r.collection("transactions"),u=await o.orderBy("timestamp","desc").limit(1).get(),l=u.empty?null:{id:u.docs[0].id,...u.docs[0].data()};t.status(200).json({subscriptionId:i?.currentSubscriptionId||null,subscriptionStatus:i?.subscriptionStatus||"inactive",lastTransactionDate:i?.lastTransactionDate||null,currentPlan:i?.currentPlan||null,latestTransaction:l})}catch(e){console.error("Dashboard Error:",e),t.status(500).json({message:"Failed to fetch dashboard data"})}}let c=(0,i.M)(n,"default"),p=(0,i.M)(n,"config"),f=new r.PagesAPIRouteModule({definition:{kind:s.A.PAGES_API,page:"/api/dashboard",pathname:"/api/dashboard",bundlePath:"",filename:""},userland:n})},33480:(e,t,a)=>{e.exports=a(75600)},46675:e=>{e.exports=require("firebase-admin")},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},86435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=t(t.s=20105);module.exports=a})();