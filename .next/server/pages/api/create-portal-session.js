"use strict";(()=>{var e={};e.id=817,e.ids=[817],e.modules={1428:e=>{e.exports=import("axios")},8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},19084:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{default:()=>u});var o=t(46675),s=t.n(o),n=t(1428),i=e([n]);n=(i.then?(await i)():i)[0];let d=()=>(s().apps.length||s().initializeApp({credential:s().credential.cert({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g,"\n")})}),s()),l=()=>d().firestore(),c="https://api.paddle.com";async function u(e,r){if("POST"!==e.method)return r.status(405).json({error:"Method not allowed"});try{let{firebaseUid:t,returnUrl:a=`${process.env.NEXT_PUBLIC_APP_URL||""}/dashboard`}=e.body;if(!t)return r.status(400).json({error:"Firebase UID is required"});let o=l(),s=await o.collection("users").doc(t).get();if(!s.exists)return r.status(404).json({error:"User not found"});let i=s.data(),u=i?.paddleCustomerId;if(u){let e=await (0,n.default)({method:"POST",url:`${c}/v2/customer-portal-sessions`,headers:{Authorization:`Bearer ${process.env.PADDLE_SECRET_API_KEY}`,"Content-Type":"application/json"},data:{customer_id:u,return_url:a}});if(e.data?.data?.url)return r.status(200).json({portalUrl:e.data.data.url});throw Error("No portal URL received from Paddle API")}{let e=await o.collection("subscriptions").where("userId","==",t).limit(1).get();if(e.empty)return r.status(404).json({error:"No subscription found for this user"});let s=e.docs[0].data();if(!s?.customData?.customerId)return r.status(404).json({error:"No Paddle customer ID found for this user"});let i=s.customData.customerId,u=await (0,n.default)({method:"POST",url:`${c}/v2/customer-portal-sessions`,headers:{Authorization:`Bearer ${process.env.PADDLE_SECRET_API_KEY}`,"Content-Type":"application/json"},data:{customer_id:i,return_url:a}});if(u.data?.data?.url)return r.status(200).json({portalUrl:u.data.data.url});throw Error("No portal URL received from Paddle API")}}catch(e){return console.error("Error creating portal session:",e),r.status(500).json({error:"Failed to create portal session",details:e instanceof Error?e.message:"Unknown error"})}}a()}catch(e){a(e)}})},33480:(e,r,t)=>{e.exports=t(75600)},46675:e=>{e.exports=require("firebase-admin")},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},76224:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{config:()=>l,default:()=>d,routeModule:()=>c});var o=t(33480),s=t(8667),n=t(86435),i=t(19084),u=e([i]);i=(u.then?(await u)():u)[0];let d=(0,n.M)(i,"default"),l=(0,n.M)(i,"config"),c=new o.PagesAPIRouteModule({definition:{kind:s.A.PAGES_API,page:"/api/create-portal-session",pathname:"/api/create-portal-session",bundlePath:"",filename:""},userland:i});a()}catch(e){a(e)}})},86435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=76224);module.exports=t})();