"use strict";(()=>{var e={};e.id=817,e.ids=[817],e.modules={1428:e=>{e.exports=import("axios")},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},19084:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>u});var o=r(46675),s=r.n(o),n=r(1428),i=e([n]);n=(i.then?(await i)():i)[0];let d=()=>(s().apps.length||s().initializeApp({credential:s().credential.cert({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g,"\n")})}),s()),l=()=>d().firestore(),c="https://api.paddle.com";async function u(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let{firebaseUid:r,returnUrl:a="http://localhost:3000/dashboard"}=e.body;if(!r)return t.status(400).json({error:"Firebase UID is required"});let o=l(),s=await o.collection("users").doc(r).get();if(!s.exists)return t.status(404).json({error:"User not found"});let i=s.data(),u=i?.paddleCustomerId;if(u){let e=await (0,n.default)({method:"POST",url:`${c}/v2/customer-portal-sessions`,headers:{Authorization:`Bearer ${process.env.PADDLE_SECRET_API_KEY}`,"Content-Type":"application/json"},data:{customer_id:u,return_url:a}});if(e.data?.data?.url)return t.status(200).json({portalUrl:e.data.data.url});throw Error("No portal URL received from Paddle API")}{let e=await o.collection("subscriptions").where("userId","==",r).limit(1).get();if(e.empty)return t.status(404).json({error:"No subscription found for this user"});let s=e.docs[0].data();if(!s?.customData?.customerId)return t.status(404).json({error:"No Paddle customer ID found for this user"});let i=s.customData.customerId,u=await (0,n.default)({method:"POST",url:`${c}/v2/customer-portal-sessions`,headers:{Authorization:`Bearer ${process.env.PADDLE_SECRET_API_KEY}`,"Content-Type":"application/json"},data:{customer_id:i,return_url:a}});if(u.data?.data?.url)return t.status(200).json({portalUrl:u.data.data.url});throw Error("No portal URL received from Paddle API")}}catch(e){return console.error("Error creating portal session:",e),t.status(500).json({error:"Failed to create portal session",details:e instanceof Error?e.message:"Unknown error"})}}a()}catch(e){a(e)}})},33480:(e,t,r)=>{e.exports=r(75600)},46675:e=>{e.exports=require("firebase-admin")},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},76224:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>l,default:()=>d,routeModule:()=>c});var o=r(33480),s=r(8667),n=r(86435),i=r(19084),u=e([i]);i=(u.then?(await u)():u)[0];let d=(0,n.M)(i,"default"),l=(0,n.M)(i,"config"),c=new o.PagesAPIRouteModule({definition:{kind:s.A.PAGES_API,page:"/api/create-portal-session",pathname:"/api/create-portal-session",bundlePath:"",filename:""},userland:i});a()}catch(e){a(e)}})},86435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=76224);module.exports=r})();