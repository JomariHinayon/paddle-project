{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.js"],"sourcesContent":["import { NextResponse } from 'next/server';\n\nconst publicRoutes = ['/', '/login', '/signup', '/confirm-signup', '/auth/action', '/checkout', '/api/webhook/paddle'];\nconst apiRoutes = ['/api/subscriptions', '/api/webhook', '/api/auth'];\n\nexport async function middleware(request) {\n  const response = NextResponse.next();\n\n  const { pathname } = request.nextUrl;\n\n  // Skip CSP enforcement for dashboard to avoid issues with Paddle\n  /* if (pathname.startsWith('/dashboard')) {\n    return response;\n  } */\n\n  // Add CSP headers with all required domains\n  const cspHeader = `\n    default-src 'self';\n    script-src 'self' 'unsafe-inline' 'unsafe-eval' https://*.paddle.com https://cdn.paddle.com https://cdn.sandbox.paddle.com https://*.datadoghq-browser-agent.com https://*.googletagmanager.com https://core.spreedly.com https://global.localizecdn.com https://js.stripe.com https://*.google.com https://apis.google.com https://*.firebaseio.com https://*.googleapis.com;\n    style-src 'self' 'unsafe-inline' https://*.paddle.com;\n    frame-src 'self' https://*.paddle.com http://localhost:* https://sandbox-buy.paddle.com https://buy.paddle.com https://checkout.paddle.com https://sandbox-checkout.paddle.com https://accounts.google.com https://*.firebaseapp.com https://*.firebase.com;\n    frame-ancestors 'self' http://localhost:* https://localhost:* https://*.paddle.com https://sandbox-buy.paddle.com https://buy.paddle.com;\n    img-src 'self' data: https: blob:;\n    font-src 'self' https://*.paddle.com;\n    connect-src 'self' https://*.paddle.com https://checkout-service.paddle.com https://sandbox-checkout-service.paddle.com https://*.firebaseio.com https://*.googleapis.com https://*.google-analytics.com https://firebaselogging-pa.googleapis.com https://*.cloudfunctions.net https://*.firebase.com https://*.firebaseapp.com wss://*.firebaseio.com https://identitytoolkit.googleapis.com;\n  `.replace(/\\s{2,}/g, ' ').trim();\n\n  // Set the CSP header\n  response.headers.set('Content-Security-Policy', cspHeader);\n  \n  // Remove report-only header - we don't need it anymore\n  // response.headers.set('Content-Security-Policy-Report-Only', cspHeader);\n  \n  // Remove COOP and COEP headers completely to allow popups to work properly\n  response.headers.delete('Cross-Origin-Opener-Policy');\n  response.headers.delete('Cross-Origin-Embedder-Policy');\n\n  // Allow public routes and API routes\n  if (publicRoutes.includes(pathname) || apiRoutes.some(route => pathname.startsWith(route))) {\n    return response;\n  }\n\n  // Check for session token\n  const session = request.cookies.get('session')?.value;\n\n  if (!session) {\n    return NextResponse.redirect(new URL('/login', request.url));\n  }\n\n  try {\n    // Simple validation check - we'll do actual verification in API routes\n    // Edge runtime doesn't support Firebase Admin, so we just do a basic format check\n    if (!session || session.split('.').length !== 3) {\n      throw new Error('Invalid session format');\n    }\n\n    // For protected routes, proceed with the user's session\n    return response;\n  } catch (error) {\n    // Clear invalid session and redirect to login\n    const redirectResponse = NextResponse.redirect(new URL('/login', request.url));\n    redirectResponse.cookies.delete('session');\n    return redirectResponse;\n  }\n}\n\nexport const config = {\n  matcher: [\n    // Protect all routes except static assets and public files\n    '/((?!_next/static|favicon.ico|.*\\\\.[^/]*$).*)',\n  ],\n};\n"],"names":[],"mappings":";;;;AAAA;AAAA;;AAEA,MAAM,eAAe;IAAC;IAAK;IAAU;IAAW;IAAmB;IAAgB;IAAa;CAAsB;AACtH,MAAM,YAAY;IAAC;IAAsB;IAAgB;CAAY;AAE9D,eAAe,WAAW,OAAO;IACtC,MAAM,WAAW,6LAAA,CAAA,eAAY,CAAC,IAAI;IAElC,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,iEAAiE;IACjE;;IAEE,GAEF,4CAA4C;IAC5C,MAAM,YAAY,CAAC;;;;;;;;;EASnB,CAAC,CAAC,OAAO,CAAC,WAAW,KAAK,IAAI;IAE9B,qBAAqB;IACrB,SAAS,OAAO,CAAC,GAAG,CAAC,2BAA2B;IAEhD,uDAAuD;IACvD,0EAA0E;IAE1E,2EAA2E;IAC3E,SAAS,OAAO,CAAC,MAAM,CAAC;IACxB,SAAS,OAAO,CAAC,MAAM,CAAC;IAExB,qCAAqC;IACrC,IAAI,aAAa,QAAQ,CAAC,aAAa,UAAU,IAAI,CAAC,CAAA,QAAS,SAAS,UAAU,CAAC,SAAS;QAC1F,OAAO;IACT;IAEA,0BAA0B;IAC1B,MAAM,UAAU,QAAQ,OAAO,CAAC,GAAG,CAAC,YAAY;IAEhD,IAAI,CAAC,SAAS;QACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;IAC5D;IAEA,IAAI;QACF,uEAAuE;QACvE,kFAAkF;QAClF,IAAI,CAAC,WAAW,QAAQ,KAAK,CAAC,KAAK,MAAM,KAAK,GAAG;YAC/C,MAAM,IAAI,MAAM;QAClB;QAEA,wDAAwD;QACxD,OAAO;IACT,EAAE,OAAO,OAAO;QACd,8CAA8C;QAC9C,MAAM,mBAAmB,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC5E,iBAAiB,OAAO,CAAC,MAAM,CAAC;QAChC,OAAO;IACT;AACF;AAEO,MAAM,SAAS;IACpB,SAAS;QACP,2DAA2D;QAC3D;KACD;AACH"}}]
}